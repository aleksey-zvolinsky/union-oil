[GLOBAL]
  TITLE = Реестр платежей и поступлений@Реєстр платежів і надходжень
  MENU = Финансы\Отчеты\Реестр платежей и поступлений@Реєстр платежів і надходжень
  VERSION = 1.3

[PANELS]
   DATEPANEL
   END

   ORGPANEL
      OPTIONS1=yyyyynnn
      STARTCONDITION1=0
   END

   PANEL
      ELEMENT Home_Alien:CheckBoxGroup
         LIST = Свои фирмы, Чужие фирмы@Свої фірми, Чужі фірми
         VALUES = 1,0
      END
   END

   PANEL
      ELEMENT DebKr:CheckBoxGroup
         LIST = Расходы, Доходы@Витрати, Доходи
         VALUES = -1,1
      END
   END

   PANEL
      ELEMENT Bank_Home_Alien:CheckBoxGroup
         LIST = Свои банки, Чужие банки@Свої банки, Чужі банки
         VALUES = 1,0
      END
   END

[DESCRIPTION]
   За период от@За період від :BeginDate до :EndDate
   Организация:@Організація:: :org1.name

[SQL]
select bank_name,
       numb,
       rach_chet,
       client_name,
       client_okpo,
       decode(home_alien, 0, 'Свой', 'Чужой') as home_alien,
       oblname,
       pponname,
       azsname,
       date_,
       activity_name,
       budget_id,
       budget_name,
       summ * debkr as summ,
       nds * debkr as nds,
       summbez * debkr as summbez,
       summ_dlr * debkr as summ_dlr,
       comments,
       TextSpring,
       permit_name,
       permit_summ,
       spring_name
  from (select eb.numb,
               eb.date_,
               eb.debkr,
               eb.comments,
               rek.rach_chet,
               nvl(bank.name, 'Касса') as bank_name,
               decode(eb.org_id, null, null, sign(nvl(von.id, 0))) as home_alien,
               decode(bank.id, null, null, sign(nvl(vbn.id, 0))) as bank_home_alien,
               ocl.name as client_name,
               ocl.id_num as client_okpo,
               decode(oo1.org_type, 8, oo1.id, null) as azsid,
               decode(oo1.org_type, 8, oo1.inst, null) as azsinst,
               decode(oo1.org_type, 8, oo1.name, null) as azsname,
               decode(oo1.org_type,
                      3,
                      oo1.id,
                      4,
                      null,
                      8,
                      decode(oo2.org_type, 3, oo2.id, null)) as pponid,
               decode(oo1.org_type,
                      3,
                      oo1.inst,
                      4,
                      null,
                      8,
                      decode(oo2.org_type, 3, oo2.inst, null)) as pponinst,
               decode(oo1.org_type,
                      3,
                      oo1.name,
                      4,
                      null,
                      8,
                      decode(oo2.org_type, 3, oo2.name, null)) as pponname,
               decode(oo1.org_type,
                      4,
                      oo1.id,
                      3,
                      oo2.id,
                      8,
                      decode(oo2.org_type, 4, oo2.id, oo3.id)) as oblid,
               decode(oo1.org_type,
                      4,
                      oo1.inst,
                      3,
                      oo2.inst,
                      8,
                      decode(oo2.org_type, 4, oo2.inst, oo3.inst)) as oblinst,
               decode(oo1.org_type,
                      4,
                      oo1.name,
                      3,
                      oo2.name,
                      8,
                      decode(oo2.org_type, 4, oo2.name, oo3.name)) as oblname,
               vebud.e_budget_id as budget_id,
               vebud.budget_name,
               vebud.activity_name,
               ebf.summ as summ,
               ebf.nds as nds,
               ebf.summbez as summbez,
               round(decode(nvl(ecr.rate, 0), 0, 0, ebf.summ / ecr.rate), 2) as summ_dlr,
               decode(eb.springid, null, null, 2, 'В пределах бюджета', 'Сверх бюджета') as TextSpring,
               p.name as permit_name,
               p.summ as permit_summ,
               eb.springid,
               s.name as spring_name
          from e_bill           eb,
               e_bill_filials   ebf,
               v_org            oo1,
               v_org            oo2,
               v_org            oo3,
               v_org            ocl,
               oil_org_rekvizit rek,
               oil_bank         bank,
               ve_budget        vebud,
               e_currency_rate  ecr,
               ve_org_native    von,
               ve_bank_native   vbn,
               e_permit         p,
               e_spring         s
         where ebf.e_bill_id = eb.id
           and ebf.inst = eb.inst
           and eb.state = 'Y'
           and eb.state = ebf.state
           and ebf.org_id = oo1.id
           and ebf.org_inst = oo1.inst
           and oo1.par = oo2.id(+)
           and oo1.par_inst = oo2.inst(+)
           and oo2.par = oo3.id(+)
           and oo2.par_inst = oo3.inst(+)
           and eb.e_budget_id = vebud.e_budget_id(+)
           and eb.rekvizit_id = rek.id(+)
           and eb.rekvizit_inst = rek.inst(+)
           and rek.id_bank = bank.id(+)
           and rek.bank_inst = bank.inst(+)
           and eb.org_id = ocl.id(+)
           and eb.org_inst = ocl.inst(+)
           and ecr.currency_id(+) = 2
           and ecr.date_(+) = eb.date_
           and von.id(+) = eb.org_id
           and von.inst(+) = eb.org_inst
           and vbn.id(+) = bank.id
           and eb.state = 'Y'
           and vbn.inst(+) = bank.inst
           and p.state(+) = 'Y'
           and p.id(+) = eb.permitid
           and s.state(+) = 'Y'
           and s.id(+) = eb.springid)
where date_ between :BeginDate and :EndDate
      and :org1.id in (AzsId,PponId,OblId)
      and (home_alien in (:Home_Alien.GetValues) or home_alien is null)
      and (bank_home_alien in (:Bank_Home_Alien.GetValues) or bank_home_alien is null)
      and debkr in (:DebKr.GetValues)
      and summ is not null
      and summ <> 0

[FIELDS]
   NAME = bank_name
   CAPTION = Банк/касса@Банк/каса
   WIDTH = 30

   NAME = rach_chet
   CAPTION = Р/с

   NAME = client_name
   CAPTION = Получатель/плательщик@Одержувач/платник
   WIDTH = 30

   NAME = client_okpo
   CAPTION = ОКПО
   WIDTH = 15

   NAME = home_alien
   CAPTION = Свой/Чужой@Свій/Чужий
   WIDTH = 20

   NAME = oblname
   CAPTION = Обл/Филиал@Обл/Філія
   WIDTH = 30

   NAME = pponname
   CAPTION = Нефтебаза@Нафтобаза
   WIDTH = 20

   NAME = azsname
   CAPTION = АЗС
   WIDTH = 10

   NAME = date_
   CAPTION = Дата
   WIDTH = 10

   NAME = activity_name
   CAPTION = Вид деятельности@Вид діяльності
   WIDTH = 15

   NAME = budget_id
   CAPTION = № статьи@№ статті
   WIDTH = 10

   NAME = budget_name
   CAPTION = Статья бюджета@Стаття бюджету
   WIDTH = 20

   NAME = numb
   CAPTION = Номер
   WIDTH = 7

   NAME = summ_dlr
   CAPTION = Сумма($)@Сума($)
   WIDTH = 15
   FORMAT = 0.00
   TOSUM = TRUE
   OPTIONAL = FALSE

   NAME = summ
   CAPTION = Сумма(грн)@Сума(грн)
   WIDTH = 15
   FORMAT = 0.00
   TOSUM = TRUE
   OPTIONAL = FALSE

   NAME = nds
   CAPTION = НДС(грн)@ПДВ(грн)
   WIDTH = 15
   FORMAT = 0.00
   TOSUM = TRUE
   OPTIONAL = FALSE

   NAME = summbez
   CAPTION = Без НДС(грн)@Без ПДВ(грн)
   WIDTH = 15
   FORMAT = 0.00
   TOSUM = TRUE
   OPTIONAL = FALSE
   
   NAME = permit_name
   CAPTION = Разрешение@Дозвіл
   WIDTH = 15
   
   NAME = permit_summ
   CAPTION = Сумма разрешения (грн)@Сума дозволу (грн)
   WIDTH = 20
   FORMAT = 0.00
   TOSUM = TRUE
   OPTIONAL = FALSE

   NAME = comments
   CAPTION = Примечание@Примітка
   WIDTH = 60

   NAME = TextSpring
   CAPTION = Тип источника@Тип джерела
   WIDTH = 22

   NAME = spring_name
   CAPTION = Источник@Джерело
   WIDTH = 22

[TYPES]
   CAPTION = Банк - Получатель@Банк - Одержувач
   ITOGI = bank_name,client_name
   UNCHECKED = activity,budget,pponname,azsname,summ_dlr

   CAPTION = По статьям подробный@По статтях докладний
   ITOGI = budget_name
   UNCHECKED = rach_chet,client_okpo,home_alien,oblname,pponname,azsname,activity_name,nds,summbez,comments,summ_dlr
   ORDER = date_,budget_name,summ,client_name,numb,bank_name

   CAPTION = Только по статьям@Тільки по статтях
   ITOGI = budget_name
   UNCHECKED = date_,client_name,numb,bank_name,rach_chet,client_okpo,home_alien,oblname,pponname,azsname,activity_name,nds,summbez,comments
   ORDER = budget_name,summ,summ_dlr